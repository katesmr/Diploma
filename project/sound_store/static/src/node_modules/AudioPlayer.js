var AudioGenerator = require("controller/AudioGenerator");
var TrackManager = require("utils/TrackManager");

module.exports = AudioPlayer;

function AudioPlayer(projectModel){
    this.projectModel = projectModel;
    this.audioGeneratorList = [];
    this.trackList = [];

    _trackDataToTrack(this);
}

AudioPlayer.prototype.play = function(note){
    var i;
    for(i = 0; i < this.audioGeneratorList.length; ++i){
        this.audioGeneratorList[i].play(note);
    }
};

AudioPlayer.prototype.pause = function(){};

AudioPlayer.prototype.stop = function(){};

AudioPlayer.prototype.save = function(fileName){
    var resultAudioBuffer;
    if(this.trackList.length === 1){
        resultAudioBuffer = this.trackList[0];
    } else if(this.trackList.length > 1){
        resultAudioBuffer = TrackManager.mergeTracks(this.trackList);
    }
    TrackManager.save(resultAudioBuffer, fileName);
    // call request of saving Project !!!!
};

AudioPlayer.prototype.export = function(){
    // save Sound
};

function _trackDataToTrack(audioPlayerObject){
    var i;
    var generator;
    var trackData = audioPlayerObject.projectModel.trackDataList;
    for(i=0; i < trackData.length; ++i){
        generator = new AudioGenerator();
        generator.generate(trackData[i]);
        audioPlayerObject.audioGeneratorList[i] = generator;
        audioPlayerObject.trackList[i] = generator.trackObject;
    }
}
