var inherit = require("../utils/inherit");
var BaseView = require("./BaseView");
var WaveForm = require("./WaveForm");
var ProjectList = require("./ProjectList");
var TrackToolView = require("./TrackToolView");
var TrackComponentView = require("./TrackComponentView");

var ProjectModel = require("../model/ProjectModel");
var ProjectListModel = require("../model/ProjectListModel");

var eventListener = require("../model/eventListener");

module.exports = ContentView;

function ContentView(){
    BaseView.call(this, "content-view");

    this.projectListModel = new ProjectListModel();
    this.projectModel = null;

    this.projectList = new ProjectList();
    this.trackToolView = new TrackToolView();
    this.trackComponentView = new TrackComponentView();

    this.sideBar = null;
    //this.trackView = null;

    this._build();
}

inherit(ContentView, BaseView);

ContentView.prototype._build = function(){
    var container = this.getContainer();

    /*if (!eventListener.subscribe(eventListener.ON_SHOW_PROJECT_LIST, this.showProjectList.bind(this))){

        console.error("Unable to subscribe to", eventListener.ON_SHOW_PROJECT_LIST, "event!");
    }*/

    eventListener.notify("SHOW_TRACK");

    eventListener.subscribe(eventListener.ON_SHOW_PROJECT_LIST, this.showProjectList.bind(this));
    eventListener.subscribe(eventListener.ON_ADD_PROJECT, this.showTrackToolView.bind(this));
    eventListener.subscribe(eventListener.ADD_TRACK, this.addTrack.bind(this));
    eventListener.subscribe(eventListener.SHOW_PROJECT, this.showCurrentProject.bind(this));

    container.append(this.projectList.getContainer());
    container.append(this.trackToolView.getContainer());
    //container.append(this.trackView.getContainer());

    this.appendToBlock($(".ui.container"));
};

ContentView.prototype.showProjectList = function(){
    this.hideAll();
    this.getContainer().append(this.projectList.getContainer());
    this.projectListModel.fetchData();
    this.projectList.show();
};

ContentView.prototype.showTrackToolView = function(){
    this.hideAll();
    this.trackToolView.show();
};

ContentView.prototype.hideAll = function(){
    this.projectList.getContainer().remove();
    //this.projectList.hide();
    this.trackToolView.hide();
    // ... hide all evelements
};

ContentView.prototype.addTrack = function(trackInfo){
    this.sideBar.addTrack(trackInfo);
    this.trackView.addTrack(trackInfo);
};

ContentView.prototype.showCurrentProject = function(eventName, projectName){
    this.hideAll();
    this.projectModel = new ProjectModel(projectName);
    this.projectModel.fetchProject();
    this.getContainer().append(this.trackComponentView.getContainer());
    this.trackComponentView.show();
};
