var inherit = require("../utils/inherit");
var BaseView = require("./BaseView");
var UserInfoBar = require("./UserInfoBar");
var TrackView = require("./TrackView");
var TrackListView = require("./TrackListView");
var ProjectListView = require("./ProjectListView");
var PlayerView = require("./PlayerView");
var Factory = require("./Factory");
var commonEventNames = require("../core/commonEventNames");
var windowsTransport = require("./windowsTransport");

module.exports = MenuBar;

function MenuBar(){
    BaseView.call(this, "menubar");

    this.userInfoBar = new UserInfoBar();
    this.backButton = Factory.createIconButton("ui button user-only", "arrow left icon", "");
    this.player = new PlayerView();
    this.recordButton = Factory.createButton("record", "record");
    this.clearButton = Factory.createButton("clear", "clear");

    this._build();
}

inherit(MenuBar, BaseView);

MenuBar.prototype._build = function(){
    var container = this.getContainer();

    //windowsTransport.notify(commonEventNames.E_DEFINE_USER);

    this.backButton.on("click", function(event){
        // Possible additional visual effect for this button...
        windowsTransport.notify(commonEventNames.ON_BACK_BUTTON_CLICK);
    });

    this.recordButton.on("click", function(){
        windowsTransport.notify(commonEventNames.E_RECORD_TRACK, $(this));
    });

    this.clearButton.on("click", function(){
        windowsTransport.notify(commonEventNames.E_CLEAR_RECORD_TRACK);
    });

    this.recordButton.hide();
    this.clearButton.hide();

    container.append(this.backButton);
    container.append(this.player.getContainer());
    container.append(this.recordButton);
    container.append(this.clearButton);
    container.append(this.userInfoBar.getContainer());
};

MenuBar.prototype.adaptToActiveWindow = function(newWindow){
    if(newWindow instanceof TrackView){
        this.showComponentForTrack(newWindow);
        this.recordButton.show();
        this.clearButton.show();
    } else if(newWindow instanceof ProjectListView){
        this.backButton.hide();
        this.player.hide();
    } else if(newWindow instanceof TrackListView){
        this.showComponentForTrack(newWindow);
    }
    // Here you can get some public properties from the window to update the "look" of the menu bar
    // For example:
    // - window.title
    // - change some controlls according to the window type
};

MenuBar.prototype.showComponentForTrack = function(newWindow){
    this.backButton.show();
    this.player.show();
    this.player.audioPlayer.setModel(newWindow.controller.model);
};
