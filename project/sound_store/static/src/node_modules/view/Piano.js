var inherit = require("../utils/inherit");
var BaseView = require("./BaseView");
var PianoModel = require("../model/PianoModel");
var Factory = require("./Factory");

module.exports = Piano;

function Piano(track){
    BaseView.call(this, "piano");
    this.track = track;
    this._build();
}

inherit(Piano, BaseView);

Piano.prototype._build = function(){
    var i, tokenNote, style, key;
    var notes = PianoModel.notes;
    var container = this.getContainer();
    var keyDistance = 40;
    var whiteKeyDistance = -40;
    var blackKeyDistance = -25;
    for (i = 0; i < notes.length; ++i){
        tokenNote = notes[i];
        key = PianoModel.keyList[i];
        if(tokenNote.isBlack() === true){
            style = "background-color: rgb(32,32,32); width: 30px; height: 120px; z-index: 1; color: #ffffff;";
            container.append(Factory.createKey("key " + key, "left: " + blackKeyDistance + "; " + style, key,
                                               tokenNote.value, undefined));
        } else{
            whiteKeyDistance += keyDistance;
            blackKeyDistance += keyDistance;
            container.append(Factory.createKey("key " + key, "left: " + whiteKeyDistance + ";", key,
                                               tokenNote.value, undefined));
        }
        //container.append(Factory.createKey(tokenNote.value, tokenNote.isBlack()));
    }
};

Piano.prototype.keyDown = function(){
    var note;
    var self = this;
    $(document).keydown(function(event){
        note = PianoModel.getNoteForKey(event.keyCode);
        if(note !== null){
            Factory.setColorToKey(String.fromCharCode(event.keyCode), "grey");
            self.track.playKeyNow(note.getValue());
        }
    });
};

Piano.prototype.keyUp = function(){
    var note;
    var self = this;
    $(document).keyup(function(event){
        note = PianoModel.getNoteForKey(event.keyCode);
        if(note !== null) {
            if (note.isBlack() === true) {
                Factory.setColorToKey(String.fromCharCode(event.keyCode), "black");
            } else {
                Factory.setColorToKey(String.fromCharCode(event.keyCode), "");
            }
            self.track.stopKeyNow();
        }
    });
};
