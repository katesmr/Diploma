var inherit = require("../utils/inherit");
var BaseView = require("./BaseView");
var MessageModal = require("./MessageModal");
var Factory = require("./Factory");
var eventListener = require("../model/eventListener");

module.exports = ProjectList;

function ProjectList(){
    BaseView.call(this, "project-list");

    this.projectList = null;
    this.title = $("<h1>Project List</h1>");
    this.addProjectButton = Factory.createIconButton("circular ui icon button", "plus icon", "");
    this.messageModal = new MessageModal("Do you really want to delete project",
                                         eventListener.CONFIRM_DELETE, eventListener.ON_DELETE_PROJECT);

    this._build();
    this.hide();
}

inherit(ProjectList, BaseView);

ProjectList.prototype._build = function(){
    var container = this.getContainer();
    eventListener.subscribe(eventListener.PROJECT_LIST_MODEL_UPDATED, this.updateProjectListElement.bind(this));
    container.append(this.title);
    container.append(this.projectList);
    container.append(this.addProjectButton);
    // eventListener.subscribe("ON_SHOW_PROJECT_LIST", this.fetchProjectList.bind(this));
};


ProjectList.prototype.updateProjectListElement = function(eventName, projectListModel){
    var container = this.getContainer();
    // Clear (possibly) old project list:
    container.empty();
    this.projectList = this.createGridData(projectListModel.projectNameList);
    container.append(this.title);
    container.append(this.projectList);
    container.append(this.addProjectButton);
};


ProjectList.prototype.createGridData = function(titleList, callback){
    var i;
    var title;
    var $item;
    var $column;
    var projectName;
    var $deleteProjectButton;
    var $table = $("<div class='five column stackable ui grid'>");
    for(i = 0; i < titleList.length; ++i){
        title = titleList[i];
        // create function for $deleteProjectButton
        $deleteProjectButton = Factory.deleteCircleButton(title, this.messageModal.show.bind(this.messageModal));
        //create function for project name ITEM
        $item = $("<a id='" + title + "'>" + title +"</a>");
        $item.on("click", function(event){
            projectName = $(this).attr("id");
            eventListener.notify(eventListener.SHOW_PROJECT, projectName);
            console.log(projectName);
        });
        $column = $("<div class='column'>");
        $column.append($item);
        $column.append($deleteProjectButton);
        $table.append($column);
    }
    return $table;
};
