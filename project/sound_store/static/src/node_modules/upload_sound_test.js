module.exports = function(){
    $.ajax({
		method: "GET",
		url: "sounds/test.wav/",
		dataType: "binary",  // blob????
		cache: false,
		processData: false,
		success: function(data){
			playSound(data);
		},
		error: function(status){
			console.error(status);
		}
	});
};

function playSound(blobObject){
    var audioData;
	//var arrayBuffer;
    var reader = new FileReader();
    var context = new AudioContext();
    reader.onload = function(){
        var arrayBuffer = reader.result;
        console.log(arrayBuffer);
        context.decodeAudioData(arrayBuffer, function(buffer){
            audioData = buffer;
            var freeverb = new Tone.Freeverb().toMaster();
            freeverb.dampening.value = 1000;
            var player = new Tone.Player(audioData).toMaster();
            //routing synth through the reverb
            //player.connect(freeverb);
            //player.start();
            var context = player.context;
            // https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode
            // get audio data for change audio with Tone
            var oscillator = context.createOscillator();
            oscillator.type = 'square';
            oscillator.connect(context.destination);
            //oscillator.start();
            console.log(oscillator);

            /*var synth = new Tone.Synth({"oscillator" : {"type" : "sine", "frequency" : 400}}).toMaster();
            //synth.frequency.value = 700;
            synth.triggerAttack(synth.frequency.value);
            console.log(synth.frequency);
            synth.triggerRelease(1);*/

            /*var synth = new Tone.Synth({"oscillator" : {"type" : "sine"}}).toMaster();
            synth.oscillator.type = "triangle"; // set type
            synth.oscillator.frequency.value = 200; // don't work
            synth.oscillator.volume.value = 10;
            synth.triggerAttack("C4");
            synth.triggerRelease(1);
            console.log(synth);*/
        });
    };
    reader.readAsArrayBuffer(blobObject);
}
