var TrackSynthesizer = require("./TrackSynthesizer");
var RequestManager = require("../utils/RequestManager");
var eventListener = require("./eventListener");

module.exports = ProjectModel;

function ProjectModel(projectName){
    this.projectName = projectName;
    this.trackModelList = [];
}

ProjectModel.prototype.setProjectNameList = function(list){
    //this.trackModelList.lenth = 0;
    var i;
    var key;
    var data;
    var track;
    var stream;
    for(i = 0; i < list.length; ++i){
        stream = list[i];
        for(key in stream){
            data = stream[key];
            if(key === "synth"){
                track = new TrackSynthesizer(i+1, key, data);
            } else if(key === "noise"){

            }
            this.trackModelList.push(track);
        }
    }
};

ProjectModel.prototype.fetchProject = function(){
    var self = this;
    RequestManager.getProject(this.projectName, function(data){
        if (data instanceof Error){
            // Smth bad is happening!!
        } else{
            self.setProjectNameList(data); // disappear after request end !!
            eventListener.notify(eventListener.PROJECT_MODEL_UPDATED, self);
        }
    });
};
